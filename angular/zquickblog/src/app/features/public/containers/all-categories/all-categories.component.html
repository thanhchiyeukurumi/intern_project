<!-- Categories Header -->
<div class="categories-header">
    <div class="categories-header-container">
      <h1 nz-typography class="page-title">Khám Phá Chủ Đề</h1>
      <p nz-typography nzType="secondary" class="page-description">
        Tìm kiếm các bài viết và quan điểm về các chủ đề bạn quan tâm.
      </p>
  
      <!-- Topics Search -->
      <div class="search-container">
        <nz-input-group [nzSuffix]="suffixButton">
          <input
            type="text"
            nz-input
            placeholder="Tìm kiếm chủ đề..."
            [(ngModel)]="searchText"
            (keyup.enter)="searchTopics()"
            class="search-input" />
        </nz-input-group>
        <ng-template #suffixButton>
          <button nz-button nzType="text" class="search-button" (click)="searchTopics()" [nzLoading]="isLoading">
            <span nz-icon nzType="search"></span>
          </button>
        </ng-template>
      </div>
    </div>
  </div>
  
  <!-- Topic Categories Content -->
  <div class="categories-content">
    <div class="categories-content-container">
      <h2 nz-typography class="section-title">Tất Cả Chủ Đề</h2>
      
      <!-- Loading spinner khi đang tải dữ liệu -->
      <div *ngIf="isLoading" class="loading-container">
        <nz-spin nzTip="Đang tải chủ đề..."></nz-spin>
      </div>
      
      <!-- Thông báo khi không có chủ đề nào -->
      <div *ngIf="!isLoading && featuredTopics.length === 0" class="empty-state">
        <p nz-typography nzType="secondary">Không tìm thấy chủ đề nào.</p>
      </div>
      
      <!-- Featured Topics Grid -->
      <div *ngIf="!isLoading && featuredTopics.length > 0" nz-row [nzGutter]="[32, 32]" class="topics-grid">
        <div nz-col [nzXs]="24" [nzMd]="12" [nzLg]="8" *ngFor="let topic of featuredTopics">
          <nz-card class="topic-card" nzHoverable>
            <div class="card-content">
              <!-- Card Header -->
              <div class="card-header">
                <div class="topic-icon" [ngClass]="[getIconBgClass(topic.iconBgColor), getIconColorClass(topic.iconColor)]">
                  <i [class]="topic.iconClass"></i>
                </div>
                <h3 nz-typography class="topic-title">{{ topic.title }}</h3>
              </div>
              <!-- Description -->
              <p nz-typography nzType="secondary" class="topic-description">{{ topic.description }}</p>
              <!-- Explore Link -->
              <a [routerLink]="topic.exploreLink" class="topic-link" [ngClass]="getLinkColorClass(topic.exploreLinkColor)">Khám phá {{ topic.title }} →</a>
  
              <!-- Popular Articles -->
              <div class="topic-articles">
                <nz-divider></nz-divider>
                <h4 class="articles-title">Bài viết phổ biến</h4>
                <!-- Loading indicator cho bài viết -->
                <div *ngIf="topic.popularArticles.length === 0" class="articles-loading">
                  <nz-spin nzSimple [nzSize]="'small'"></nz-spin>
                </div>
                <ul class="articles-list" *ngIf="topic.popularArticles.length > 0">
                  <li *ngFor="let article of topic.popularArticles">
                    <a [routerLink]="article.url" class="article-link">{{ article.title }}</a>
                  </li>
                </ul>
              </div>
            </div>
          </nz-card>
        </div>
      </div>
  
      <!-- More Topics Button -->
      <div *ngIf="!isLoading && featuredTopics.length > 0 && hasMoreCategories" class="more-topics-container">
        <button nz-button class="explore-more-button" (click)="loadMoreCategories()" [nzLoading]="isLoadingMore">
          Khám Phá Thêm Chủ Đề
        </button>
      </div>
      
      <!-- End of categories message -->
      <div *ngIf="!isLoading && !hasMoreCategories && featuredTopics.length > categoriesPerPage" class="end-of-categories">
        <nz-divider nzText="Đã xem hết tất cả chủ đề"></nz-divider>
      </div>
    </div>
  </div>
  
  <!-- Recommended Publications Section -->
  <div class="publications-section">
    <div class="publications-container">
      <h2 nz-typography class="section-title">Tác Giả Đề Xuất</h2>
      <div nz-row [nzGutter]="[32, 32]" class="publications-grid">
        <div nz-col [nzXs]="24" [nzSm]="12" [nzLg]="6" *ngFor="let pub of recommendedPublications">
            <div class="publication-card">
               <img [src]="pub.imageUrl" [alt]="pub.title + ' cover'" class="publication-image">
               <h3 nz-typography class="publication-title">{{ pub.title }}</h3>
               <p nz-typography nzType="secondary" class="publication-description">{{ pub.description }}</p>
               <a [href]="pub.followLink" target="_blank" rel="noopener noreferrer" class="publication-link">Theo dõi</a>
            </div>
        </div>
      </div>
    </div>
  </div>