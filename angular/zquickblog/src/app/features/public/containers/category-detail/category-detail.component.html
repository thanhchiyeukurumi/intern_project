<!-- Container chính -->
<div class="category-page">
  <!-- Hiển thị skeleton loader khi đang tải -->
  <div *ngIf="isLoading" class="category-loading">
    <nz-skeleton [nzActive]="true" [nzParagraph]="{ rows: 4 }"></nz-skeleton>
    <nz-skeleton [nzActive]="true" [nzParagraph]="{ rows: 3 }"></nz-skeleton>
    <nz-skeleton [nzActive]="true" [nzParagraph]="{ rows: 3 }"></nz-skeleton>
  </div>

  <!-- Hiển thị nội dung khi đã tải xong -->
  <ng-container *ngIf="!isLoading && category">
    <!-- Header của danh mục -->
    <div class="category-header">
      <div class="container">
        <h1 class="category-title">{{ category.data.name }}</h1>
        <p class="category-description" *ngIf="category.description">{{ category.description }}</p>
      </div>
    </div>

    <!-- Grid layout cho nội dung -->
    <div class="container">
      <div nz-row [nzGutter]="[24, 24]">
        <!-- Cột trái: Bài viết nổi bật + Xu hướng -->
        <div nz-col [nzXs]="24" [nzSm]="24" [nzMd]="16" [nzLg]="16">
          
          <!-- Bài viết nổi bật -->
          <section class="featured-post-section" *ngIf="featuredPost">
            <h2 class="section-title">Bài viết nổi bật</h2>
            <div class="featured-post-card">
              <nz-card [nzCover]="featuredPostCover">
                <ng-template #featuredPostCover>
                  <!-- <div class="post-cover">
                    <img alt="{{ featuredPost.title }}" class="post-cover-image" src="assets/images/post-placeholder.jpg" />
                  </div> -->
                </ng-template>
                
                <div class="post-meta-top">
                  <span class="post-tag" *ngIf="featuredPost.Categories && featuredPost.Categories.length > 0">
                    {{ featuredPost.Categories[0].name }}
                  </span>
                  <span class="post-date">{{ formatDate(featuredPost.createdAt) }}</span>
                  <span class="post-read-time">{{ estimateReadTime(featuredPost.content) }} phút đọc</span>
                </div>
                
                <h3 class="post-title featured-post-title">
                  <a [routerLink]="['/post', featuredPost.id]">{{ featuredPost.title }}</a>
                </h3>
                
                <p class="post-excerpt">{{ featuredPost.excerpt || featuredPost.description }}</p>
                
                <div class="post-author">
                  <nz-avatar [nzSize]="32" nzIcon="user" [nzSrc]="featuredPost.User?.avatar || 'assets/images/default-avatar.png'"></nz-avatar>
                  <span class="author-name">{{ featuredPost.User?.username || 'Tác giả ẩn danh' }}</span>
                </div>
              </nz-card>
            </div>
          </section>
          
          <!-- Bài viết xu hướng -->
          <section class="trending-posts-section" *ngIf="trendingPosts.length > 0">
            <h2 class="section-title">Xu hướng</h2>
            <div class="trending-posts-list">
              <div class="trending-post-item" *ngFor="let post of trendingPosts">
                <div class="post-meta-top">
                  <span class="post-tag" *ngIf="post.Categories && post.Categories.length > 0">
                    {{ post.Categories[0].name }}
                  </span>
                  <span class="post-date">{{ formatDate(post.createdAt) }}</span>
                  <span class="post-read-time">{{ estimateReadTime(post.content) }} phút đọc</span>
                </div>
                
                <h3 class="post-title trending-post-title">
                  <a [routerLink]="['/post', post.id]">{{ post.title }}</a>
                </h3>
                
                <p class="post-excerpt">{{ post.excerpt || post.description }}</p>
                
                <div class="post-author">
                  <nz-avatar [nzSize]="32" nzIcon="user" [nzSrc]="post.User?.avatar || 'assets/images/default-avatar.png'"></nz-avatar>
                  <span class="author-name">{{ post.User?.username || 'Tác giả ẩn danh' }}</span>
                </div>
              </div>
            </div>
          </section>
          
          <!-- Bài viết mới nhất -->
          <section class="latest-posts-section" *ngIf="latestPosts.length > 0">
            <h2 class="section-title">Mới nhất</h2>
            <div class="latest-posts-grid" nz-row [nzGutter]="[16, 16]">
              <div nz-col [nzXs]="24" [nzSm]="12" *ngFor="let post of latestPosts" class="latest-post-col">
                <nz-card class="latest-post-card post-card" [nzCover]="latestPostCover">
                  <ng-template #latestPostCover>
                    <div class="post-cover">
                      <img 
                        [alt]="post.title" 
                        class="post-cover-image" 
                        >
                    </div>
                  </ng-template>
                  
                  <div class="post-meta-top">
                    <span class="post-tag" *ngIf="post.Categories && post.Categories.length > 0">
                      {{ post.Categories[0].name }}
                    </span>
                    <span class="post-date">{{ formatDate(post.createdAt) }}</span>
                  </div>
                  
                  <h3 class="post-title latest-post-title">
                    <a [routerLink]="['/post', post.id]">{{ post.title }}</a>
                  </h3>
                  
                  <div class="post-author">
                    <nz-avatar [nzSize]="24" nzIcon="user" [nzSrc]="post.User?.avatar || 'assets/images/default-avatar.png'"></nz-avatar>
                    <span class="author-name">{{ post.User?.username || 'Tác giả ẩn danh' }}</span>
                  </div>
                </nz-card>
              </div>
            </div>
            
            <!-- Nút "Xem thêm" cho bài viết mới nhất -->
            <div class="load-more-container">
              <button nz-button nzType="default" class="load-more-button" (click)="loadMoreLatestPosts()">
                <span nz-icon nzType="plus"></span>
                Xem thêm bài viết
              </button>
            </div>
          </section>
        </div>
        
        <!-- Cột phải: Sidebar với Related Topics và các thẻ khác -->
        <div nz-col [nzXs]="24" [nzSm]="24" [nzMd]="8" [nzLg]="8">
          <div class="category-sidebar">
            
            <!-- Related Topics -->
            <section class="related-topics-section" *ngIf="relatedTopics.length > 0">
              <h2 class="section-title">Chủ đề liên quan</h2>
              <div class="related-topics-tags">
                <a *ngFor="let topic of relatedTopics" class="topic-tag" [routerLink]="['/categories', topic.id]">
                  {{ topic.name }}
                </a>
              </div>
            </section>
            
            <!-- Nút quay lại đầu trang -->
            <div class="back-to-top">
              <button 
                nz-button 
                nzType="default" 
                nzShape="circle" 
                class="back-to-top-button" 
                (click)="scrollToTop()"
                nz-tooltip
                nzTooltipTitle="Lên đầu trang">
                <span nz-icon nzType="arrow-up"></span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </ng-container>
  
  <!-- Hiển thị khi không tìm thấy danh mục -->
  <div *ngIf="!isLoading && !category" class="category-not-found">
    <h2>Không tìm thấy danh mục</h2>
    <p>Danh mục bạn đang tìm kiếm không tồn tại hoặc đã bị xóa.</p>
    <button nz-button nzType="primary" routerLink="/categories">Xem tất cả danh mục</button>
  </div>
</div>