<nz-card ngSkipHydration>
  <div class="header-container">
    <div class="title-section">
      <h2 class="card-title">All Posts</h2>
      <button nz-button nzType="primary">
        <i nz-icon nzType="plus"></i> Add New Post
      </button>
    </div>

    <div class="filter-section">
      <div class="search-container">
        <nz-input-group [nzPrefix]="prefixIconSearch">
          <input
            type="text"
            nz-input
            placeholder="Search posts..."
            [(ngModel)]="searchValue"
            (ngModelChange)="searchAndFilter()"
            (keyup.enter)="searchAndFilter()" />
        </nz-input-group>
        <ng-template #prefixIconSearch>
          <i nz-icon nzType="search"></i>
        </ng-template>
      </div>

      <div class="filters">
        <nz-select
          class="filter-select"
          nzPlaceHolder="All Categories"
          [(ngModel)]="selectedCategory"
          (ngModelChange)="searchAndFilter()">
          <nz-option nzValue="" nzLabel="All Categories"></nz-option>
          <nz-option nzValue="Công nghệ" nzLabel="Công nghệ"></nz-option>
          <nz-option nzValue="Phần mềm" nzLabel="Phần mềm"></nz-option>
        </nz-select>

        <nz-select
          class="filter-select"
          nzPlaceHolder="All Time"
          [(ngModel)]="selectedDate"
          (ngModelChange)="searchAndFilter()">
          <nz-option nzValue="null" nzLabel="All Time"></nz-option>
          <nz-option nzValue="today" nzLabel="Today"></nz-option>
          <nz-option nzValue="week" nzLabel="This Week"></nz-option>
          <nz-option nzValue="month" nzLabel="This Month"></nz-option>
        </nz-select>
      </div>
    </div>
  </div>

  <nz-table
    #basicTable
    [nzData]="displayData"
    [nzLoading]="loading"
    [nzShowPagination]="false"
    class="posts-table">
    <thead>
      <tr>
        <!-- <th>data</th> -->
        <th [nzWidth]="'50px'"
            [nzChecked]="checked"
            [nzIndeterminate]="indeterminate"
            (nzCheckedChange)="onAllChecked($event)"></th>
        <th [nzWidth]="'320px'">Post</th>
        <th>Author</th>
        <th>Category</th> 
        <th>Date</th>
        <th [nzAlign]="'right'">Actions</th>
      </tr>
    </thead>
    <tbody *ngIf="displayData.length > 0">
      <tr *ngFor="let data of displayData">
        <!-- <td>{{ data | json }}</td> -->
        <td [nzChecked]="setOfCheckedId.has(data.id)" (nzCheckedChange)="onItemChecked(data.id, $event)"></td>
        <td>{{ data.title }}</td>
        <!-- Author -->
        <td>
          <div class="author-cell">
            <nz-avatar [nzSrc]="getAuthorAvatar(data.User?.avatar)"></nz-avatar>
            <span class="author-name">{{ data.User?.username || 'Unknown' }}</span>
          </div>
        </td>
        <!-- Categories -->
        <td>
          <ng-container *ngIf="data.Categories && data.Categories.length > 0">
            <nz-tag [nzColor]="getCategoryColor(data.Categories[1].name)">{{ data.Categories[1].name }}</nz-tag>
          </ng-container>
          <span *ngIf="!data.Categories || data.Categories.length === 0">Uncategorized</span>
        </td> 
        <!-- Date -->
        <td>
           {{ data.createdAt | date:'MMM d, y' }} <!-- Sử dụng DatePipe -->
        </td>
        <!-- Actions -->
        <td [nzAlign]="'right'" class="action-buttons">
           <button nz-button nzType="link" class="edit-button">
             <i nz-icon nzType="edit"></i>
           </button>
          <button nz-button nzType="link" class="delete-button" (click)="confirmDeletePost(data)">
            <i nz-icon nzType="delete"></i>
          </button>
        </td>
      </tr>
    </tbody>
      <nz-empty *ngIf="!loading && displayData.length === 0" nzNotFoundContent="No posts found"></nz-empty>
  </nz-table>

  <!-- Pagination Container -->
  <div class="pagination-container" *ngIf="total > 0">
    <div class="pagination-info" [innerHTML]="getPaginationInfo()"></div>
    <nz-pagination
      [(nzPageIndex)]="pageIndex"
      [(nzPageSize)]="pageSize"
      [nzTotal]="total"
      nzShowSizeChanger
      (nzPageIndexChange)="onPageIndexChange($event)"
      (nzPageSizeChange)="onPageSizeChange($event)"
      [nzPageSizeOptions]="[5, 10, 20, 50]">
    </nz-pagination>
  </div>
</nz-card>