<div class="page-header">
  <h2 nz-typography>Bình luận</h2>

  <div class="action-area">
    <!-- Tìm kiếm -->
    <nz-input-group [nzSuffix]="suffixIconSearch" class="search-box">
      <input type="text"
             nz-input placeholder="Tìm kiếm bình luận..."
             [(ngModel)]="searchValue" (keyup.enter)="onSearch()" />
    </nz-input-group>
    <ng-template #suffixIconSearch>
      <span nz-icon nzType="search"></span>
    </ng-template>
  </div>
</div>

<nz-card ngSkipHydration [nzLoading]="loading" [nzBodyStyle]="{ padding: '20px' }">
  <div class="comments-list" *ngIf="!loading && displayComments.length > 0">
    <!-- Lặp qua displayComments để hiển thị từng bình luận -->
    <div class="comment-card" *ngFor="let comment of displayComments">
      <div class="comment-header">
        <div class="author-info">
          <nz-avatar [nzSrc]="getAuthorAvatar(comment)" [nzSize]="46"></nz-avatar>
          <div class="author-details">
            <h4 class="author-name">{{ getAuthorUsername(comment) }}</h4>
            <span class="comment-date">
              <span nz-icon nzType="clock-circle" nzTheme="outline"></span> 
              {{ comment.createdAt | date:'dd/MM/yyyy, HH:mm' }}
            </span>
          </div>
        </div>
      </div>

      <div class="comment-content">
        <div class="post-title">
          <span nz-icon nzType="file-text" nzTheme="outline"></span> Bài viết:
          <a *ngIf="getPostSlug(comment)" [routerLink]="['/post', getPostSlug(comment)]">
             {{ getPostTitle(comment) }}
          </a>
          <span *ngIf="!getPostSlug(comment)">{{ getPostTitle(comment) }}</span>
        </div>
        <p class="comment-text">{{ comment.content }}</p>
      </div>

      <!-- Actions -->
      <div class="comment-actions">
        <button
          nz-button
          nzType="text"
          nzDanger
          nzSize="small"
          nz-popconfirm
          nzPopconfirmTitle="Bạn có chắc chắn muốn xóa bình luận này?"
          nzPopconfirmPlacement="topRight"
          (nzOnConfirm)="confirmDeleteComment(comment)">
          <span nz-icon nzType="delete"></span> Xóa
        </button>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="!loading && displayComments.length === 0">
    <span nz-icon nzType="message" nzTheme="outline"></span>
    <p>Chưa có bình luận nào</p>
    <small>Khi có người bình luận vào bài viết của bạn, nó sẽ xuất hiện ở đây</small>
  </div>

  <!-- Pagination Container -->
  <div class="pagination-container" *ngIf="total > 0">
    <div class="pagination-info" [innerHTML]="getPaginationInfo()"></div>
    <nz-pagination
      [(nzPageIndex)]="pageIndex"
      [(nzPageSize)]="pageSize"
      [nzTotal]="total"
      nzShowSizeChanger
      (nzPageIndexChange)="onPageIndexChange($event)"
      (nzPageSizeChange)="onPageSizeChange($event)"
      [nzPageSizeOptions]="[10, 20, 50, 100]">
    </nz-pagination>
  </div>
</nz-card>