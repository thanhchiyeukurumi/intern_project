<div class="post-edit-container"> <!-- Đổi class nếu muốn style riêng, hoặc dùng chung -->
    <nz-spin [nzSpinning]="isLoadingData" nzTip="Đang tải dữ liệu bài viết...">
      <h1 class="page-title">
        {{ currentPost?.original_post_id ? 'Chỉnh sửa bản dịch/biến thể' : 'Chỉnh sửa bài viết' }}
        <span *ngIf="currentPost && !currentPost.original_post_id">ID: {{ currentPost.id }}</span>
      </h1>
  
      <form [formGroup]="postForm" (ngSubmit)="submitPost()" *ngIf="!isLoadingData && postForm">
        <nz-card>
          <!-- Tiêu đề -->
          <nz-form-item>
            <nz-form-label [nzSpan]="24" nzRequired>Tiêu đề</nz-form-label>
            <nz-form-control [nzSpan]="24" [nzErrorTip]="titleErrorTpl">
              <input nz-input formControlName="title" placeholder="Nhập tiêu đề bài viết" />
            </nz-form-control>
            <ng-template #titleErrorTpl let-control>
              <ng-container *ngIf="control.hasError('required')">Vui lòng nhập tiêu đề.</ng-container>
              <ng-container *ngIf="control.hasError('minlength')">Tiêu đề phải có ít nhất 5 ký tự.</ng-container>
              <ng-container *ngIf="control.hasError('maxlength')">Tiêu đề không được vượt quá 200 ký tự.</ng-container>
            </ng-template>
          </nz-form-item>
  
          <!-- Nội dung -->
          <nz-form-item>
            <nz-form-label [nzSpan]="24" nzRequired>Nội dung</nz-form-label>
            <nz-form-control [nzSpan]="24" nzErrorTip="Vui lòng nhập nội dung bài viết">
              <app-quill-editor
                formControlName="content"
                [placeholder]="'Bắt đầu viết nội dung của bạn...'"
                [minHeight]="'400px'"
                (editorCreated)="handleEditorCreated($event)">
              </app-quill-editor>
            </nz-form-control>
          </nz-form-item>
  
          <nz-divider></nz-divider>
  
          <div nz-row [nzGutter]="16">
            <!-- Danh mục -->
            <div nz-col [nzMd]="12" [nzSm]="24">
              <nz-form-item>
                <nz-form-label [nzSm]="24" [nzMd]="24" nzRequired>Danh mục</nz-form-label>
                <nz-form-control [nzSm]="24" [nzMd]="24" nzErrorTip="Vui lòng chọn ít nhất một danh mục">
                  <nz-select
                    formControlName="categories"
                    nzMode="multiple"
                    nzPlaceHolder="Chọn danh mục"
                    [nzLoading]="categoriesForSelect.length === 0 && isLoadingData">
                    <nz-option
                      *ngFor="let category of categoriesForSelect"
                      [nzLabel]="category.label"
                      [nzValue]="category.value">
                    </nz-option>
                  </nz-select>
                </nz-form-control>
              </nz-form-item>
            </div>
  
            <!-- Ngôn ngữ -->
            <div nz-col [nzMd]="12" [nzSm]="24">
              <nz-form-item>
                <nz-form-label [nzSm]="24" [nzMd]="24" nzRequired>Ngôn ngữ</nz-form-label>
                <nz-form-control [nzSm]="24" [nzMd]="24" nzErrorTip="Vui lòng chọn ngôn ngữ">
                  <nz-select
                    formControlName="language_id"
                    nzPlaceHolder="Chọn ngôn ngữ cho bài viết"
                    [nzLoading]="languagesForSelect.length === 0 && isLoadingData">
                    <nz-option
                      *ngFor="let lang of languagesForSelect"
                      [nzLabel]="lang.label"
                      [nzValue]="lang.value">
                    </nz-option>
                  </nz-select>
                </nz-form-control>
              </nz-form-item>
            </div>
          </div>
  
          <!-- Tóm tắt (Excerpt/Description) -->
          <nz-form-item>
            <nz-form-label [nzSpan]="24" nzRequired>Mô tả / Tóm tắt</nz-form-label>
            <nz-form-control [nzSpan]="24" [nzErrorTip]="descriptionErrorTpl">
              <textarea
                nz-input
                formControlName="description"
                placeholder="Nhập mô tả ngắn hoặc tóm tắt cho bài viết (sẽ hiển thị trong danh sách bài viết và SEO)"
                [nzAutosize]="{ minRows: 3, maxRows: 6 }">
              </textarea>
            </nz-form-control>
            <ng-template #descriptionErrorTpl let-control>
                <ng-container *ngIf="control.hasError('required')">Vui lòng nhập mô tả/tóm tắt.</ng-container>
                <ng-container *ngIf="control.hasError('minlength')">Mô tả phải có ít nhất 10 ký tự.</ng-container>
                <ng-container *ngIf="control.hasError('maxlength')">Mô tả không được vượt quá 500 ký tự.</ng-container>
            </ng-template>
          </nz-form-item>
  
          <!-- Original Post ID (hiển thị nếu là bản dịch, và nên readonly/disabled) -->
           <nz-form-item *ngIf="postForm.get('original_post_id')?.value">
             <nz-form-label [nzSpan]="24">Bài viết gốc ID</nz-form-label>
             <nz-form-control [nzSpan]="24">
               <input nz-input formControlName="original_post_id" />
               <!-- Control này đã được set disabled: true trong initForm -->
             </nz-form-control>
           </nz-form-item>
  
  
          <div class="action-buttons">
            <button nz-button nzType="default" type="button" (click)="router.navigate(['/blogger/posts'])" [disabled]="isSubmitting || isLoadingData">
              Hủy bỏ
            </button>
            <button
              nz-button
              nzType="primary"
              type="submit"
              [nzLoading]="isSubmitting"
              [disabled]="isLoadingData">
              {{ isSubmitting ? 'Đang xử lý...' : (currentPost?.original_post_id ? 'Cập nhật bản dịch' : 'Cập nhật bài viết') }}
            </button>
          </div>
        </nz-card>
      </form>
      <div *ngIf="!isLoadingData && !postForm" class="error-message">
          Không thể tải form chỉnh sửa bài viết.
      </div>
    </nz-spin>
  </div>